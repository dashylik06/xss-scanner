<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ XSS - XSS Scanner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ XSS</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-—Å–∞–π—Ç–∞ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏</p>
        </header>

        <nav>
            <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/scan" class="nav-link active">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            <a href="/history" class="nav-link">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="/statistics" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        </nav>

        <main>
            {% if error %}
            <div class="alert error">
                {{ error }}
            </div>
            {% endif %}

            {% if not scan_id %}
            <div class="scan-form">
                <h2>–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <form method="POST">
                    <div class="form-group">
                        <label for="url">URL —Å–∞–π—Ç–∞:</label>
                        <input type="url" id="url" name="url"
                               placeholder="https://example.com"
                               required
                               value="{{ request.form.url if request.form.url }}">
                    </div>

                    <div class="form-group">
                        <label for="scan_type">–¢–∏–ø —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                        <select id="scan_type" name="scan_type">
                            <option value="fast">–ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="deep">–ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        </select>
                    </div>

                    <button type="submit" class="scan-button">–ù–∞—á–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                </form>
            </div>
            {% else %}
            <div class="scan-progress">
                <h2>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</h2>
                <p>URL: <strong>{{ url }}</strong></p>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                    <div class="progress-text" id="progressText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
                </div>

                <div id="scanResults" style="display: none;">
                    <a href="/report/{{ scan_id }}" class="cta-button">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç</a>
                </div>
            </div>

            <script>
                const scanId = "{{ scan_id }}";

                function checkProgress() {
                    fetch(`/scan_status/${scanId}`)
                        .then(response => response.json())
                        .then(data => {
                            const progressFill = document.getElementById('progressFill');
                            const progressText = document.getElementById('progressText');
                            const scanResults = document.getElementById('scanResults');

                            if (data.status === 'completed') {
                                progressFill.style.width = '100%';
                                progressFill.textContent = '100%';
                                progressText.textContent = '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!';
                                scanResults.style.display = 'block';
                                return;
                            }

                            if (data.status === 'error') {
                                progressFill.style.width = '100%';
                                progressFill.style.backgroundColor = '#e74c3c';
                                progressFill.textContent = '–û—à–∏–±–∫–∞';
                                progressText.textContent = data.message;
                                return;
                            }

                            const progress = data.progress || 0;
                            progressFill.style.width = `${progress}%`;
                            progressFill.textContent = `${progress}%`;
                            progressText.textContent = data.message || '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';

                            setTimeout(checkProgress, 1000);
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞:', error);
                            setTimeout(checkProgress, 2000);
                        });
                }

                checkProgress();
            </script>
            {% endif %}

            <div class="info-box">
                <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é:</h3>
                <ul>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–π URL (–≤–∫–ª—é—á–∞—è http:// –∏–ª–∏ https://)</li>
                    <li>–ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</li>
                    <li>–ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã (–∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏)</li>
                    <li>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–µ —Å–∞–π—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∏–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ</li>
                </ul>
            </div>
        </main>
    </div>
</body>
</html>